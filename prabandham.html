<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆழ்வர்களின் அருளிச்செயல்</title>
</head>
<body>
    <p><h1><span id="section-title" style="color: #6257bd;">முதலாயிரம்</span></h1></p>
    <audio id="playlist" controls autoplay></audio>
    <p id="track-info">Track 1 of 70</p>
    <p>
      <label for="goto-track">Goto Track:</label>
      <input type="number" id="goto-track" min="1" max="70" placeholder="1-70" style="width: 4em;">
      <button type="button" id="goto-btn">Go</button>
    </p>

    <script>
      const STORAGE_KEY = 'prabandham-last-track';

      function getSectionTitle(trackNum) {
        if (trackNum >= 1 && trackNum <= 17) return 'முதலாயிரம்';
        if (trackNum >= 18 && trackNum <= 37) return 'பெரிய திருமொழி';
        if (trackNum >= 38 && trackNum <= 53) return 'திருவாய்மொழி';
        if (trackNum >= 54 && trackNum <= 67) return 'இயற்பா';
        if (trackNum >= 68 && trackNum <= 70) return 'slokas';
        return '';
      }

      function getTrackPath(trackNum) {
        if (trackNum >= 1 && trackNum <= 17) return 'music/prabhandham/mudhalayiram/';
        if (trackNum >= 18 && trackNum <= 37) return 'music/prabhandham/02.PERIYATHIRUMOZHI/';
        if (trackNum >= 38 && trackNum <= 53) return 'music/prabhandham/03.THIRUVOIMOZHI/';
        if (trackNum >= 54 && trackNum <= 67) return 'music/prabhandham/04.IYARPA/';
        if (trackNum >= 68 && trackNum <= 70) return 'music/slokas/';
        return '';
      }

      const tracks = [];
      for (let i = 1; i <= 17; i++) {
        tracks.push(getTrackPath(i) + String(i).padStart(2, '0') + '.mp3');
      }
      for (let i = 18; i <= 37; i++) {
        tracks.push(getTrackPath(i) + String(i - 17).padStart(2, '0') + '.mp3');
      }
      for (let i = 38; i <= 53; i++) {
        tracks.push(getTrackPath(i) + String(i - 37).padStart(2, '0') + '.mp3');
      }
      for (let i = 54; i <= 67; i++) {
        tracks.push(getTrackPath(i) + String(i - 53).padStart(2, '0') + '.mp3');
      }
      for (let i = 68; i <= 70; i++) {
        tracks.push(getTrackPath(i) + String(i - 67).padStart(2, '0') + '.mp3');
      }

      const audio = document.getElementById('playlist');
      const trackInfo = document.getElementById('track-info');
      const sectionTitle = document.getElementById('section-title');
      const gotoInput = document.getElementById('goto-track');
      const gotoBtn = document.getElementById('goto-btn');
      let currentIndex = 0;

      function playTrack(index) {
        if (index < 0 || index >= tracks.length) return;
        currentIndex = index;
        audio.src = tracks[index];
        audio.load();
        audio.play();
        trackInfo.textContent = 'Track ' + (index + 1) + ' of 70';
        sectionTitle.textContent = getSectionTitle(index + 1);
        localStorage.setItem(STORAGE_KEY, String(index + 1));
      }

      audio.addEventListener('ended', function() {
        if (currentIndex < tracks.length - 1) {
          playTrack(currentIndex + 1);
        }
        else {  
          playTrack(0);
        }        
      });

      gotoBtn.addEventListener('click', function() {
        const num = parseInt(gotoInput.value, 10);
        if (num >= 1 && num <= 70) {
          playTrack(num - 1);
        }
      });

      gotoInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          gotoBtn.click();
        }
      });

      const lastTrack = parseInt(localStorage.getItem(STORAGE_KEY), 10);
      if (lastTrack >= 1 && lastTrack <= 70) {
        playTrack(lastTrack - 1);
      } else {
        playTrack(0);
      }
    </script>

    

</body>
</html>